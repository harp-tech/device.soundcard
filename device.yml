%YAML 1.1
---
# yaml-language-server: $schema=https://harp-tech.org/draft-02/schema/device.json
device: SoundCard
whoAmI: 1280
firmwareVersion: "3.0"
hardwareTargets: "1.1"
registers:
  PlaySoundOrFrequency: &frequency
    address: 32
    type: U16
    access: Write
    description: Starts the sound index (if less than 32) or frequency (if greater or equal than 32)
  Stop:
    address: 33
    type: U8
    access: [Write, Event]
    description: Any value will stop the frequency generation (not implemented for a sound index). The time precision of this event it frequency dependent. It's +/- 2500 us at 500 Hz, +/- 750 us at 1000 Hz, +/- 250 us at 2000 Hz and bellow +/- 210 us for any frequency above 5000 Hz.
  AttenuationLeft: &attenuation
    address: 34
    type: U16
    access: Write
    description: Configure left channel's attenuation (1 LSB is 0.1dB)
  AttenuationRight:
    <<: *attenuation
    address: 35
    description: Configure right channel's attenuation (1 LSB is 0.1dB)
  AttenuationBoth:
    <<: *attenuation
    address: 36
    length: 2
    description: Configures both attenuation on right and left channels [Att R] [Att L] (1 LSB is 0.1dB)
  AttenuationAndPlaySoundOrFreq:
    <<: *attenuation
    address: 37
    length: 3
    description: Configures attenuation and plays sound index or frequency [Att R] [Att L] [Index]
  Reserved0: &reserved
    address: 38
    type: U8
    access: Read
    description: Reserved for future use
    visibility: private
  Reserved1:
    <<: *reserved
    address: 39
  InputState:
    address: 40
    type: U8
    access: Event
    maskType: DigitalInputs
    description: State of the digital inputs
  ConfigureDI0: &configureDI
    address: 41
    type: U8
    access: Write
    maskType: DigitalInputConfiguration
    description: Configuration of the digital input 0 (DI0)
  ConfigureDI1:
    <<: *configureDI
    address: 42
    description: Configuration of the digital input 1 (DI1)
  SoundOrFrequencyDI0: &soundIndex
    address: 43
    type: U16
    access: Write
    description: Specifies the sound index to be played when triggering DI0
  SoundOrFrequencyDI1:
    <<: *soundIndex
    address: 44
    description: Specifies the sound index to be played when triggering DI1
  AttenuationLeftDI0:
    <<: *attenuation
    address: 45
    description: Left channel's attenuation (1 LSB is 0.1dB) when triggering DI0
  AttenuationLeftDI1:
    <<: *attenuation
    address: 46
    description: Left channel's attenuation (1 LSB is 0.1dB) when triggering DI1
  AttenuationRightDI0:
    <<: *attenuation
    address: 47
    description: Right channel's attenuation (1 LSB is 0.1dB) when triggering DI0
  AttenuationRightDI1:
    <<: *attenuation
    address: 48
    description: Right channel's attenuation (1 LSB is 0.1dB) when triggering DI1
  Reserved2:
    <<: *reserved
    address: 49
  Reserved3:
    <<: *reserved
    address: 50
  Reserved4:
    <<: *reserved
    address: 51
  ConfigureDO0: &configureDO
    address: 52
    type: U8
    access: Write
    maskType: DigitalOutputConfiguration
    description: Configuration of the digital output 0 (DO0)
  ConfigureDO1:
    <<: *configureDO
    address: 53
    description: Configuration of the digital output 1 (DO1)
  ConfigureDO2:
    <<: *configureDO
    address: 54
    description: Configuration of the digital output 2 (DO2)
  Reserved5:
    <<: *reserved
    address: 55
  Reserved6:
    <<: *reserved
    address: 56
  Reserved7:
    <<: *reserved
    address: 57
  OutputSet: &output
    address: 58
    type: U8
    access: Write
    maskType: DigitalOutputs
    description: Set the specified digital output lines
  OutputClear:
    <<: *output
    address: 59
    description: Clear the specified digital output lines
  OutputToggle:
    <<: *output
    address: 60
    description: Toggle the specified digital output lines
  OutputState:
    <<: *output
    address: 61
    description: Write the state of all digital output lines
  Reserved8:
    <<: *reserved
    address: 62
  Reserved9:
    <<: *reserved
    address: 63
  EnableDataStream:
    address: 64
    type: U8
    access: Write
    maskType: DataStreamConfiguration
    description: Configuration of the data stream
  DataStream:
    address: 65
    type: U16
    access: Event
    length: 5
    description: Contains sampled analog input data and sound parameters.
    payloadSpec:
      Adc0:
        offset: 0
        description: The sampled analog input value on ADC0.
      Adc1:
        offset: 1
        description: The sampled analog input value on ADC1.
      AttenuationLeft:
        offset: 2
        description: The current amplitude of the left channel.
      AttenuationRight:
        offset: 3
        description: The current amplitude of the right channel.
      Frequency:
        offset: 4
        description: The output sound index (if less than 32) or frequency (if greater or equal than 32) being played.
  ConfigureAdc0:
    address: 66
    type: U8
    access: Write
    maskType: Adc0Configuration
    visibility: private
    description: Configuration of analog input ADC0 (not implemented yet)
  ConfigureAdc1:
    address: 67
    type: U8
    access: Write
    maskType: Adc1Configuration
    visibility: private
    description: Configuration of analog input ADC1 (not implemented yet)
  Reserved10:
    <<: *reserved
    address: 68
  Reserved11:
    <<: *reserved
    address: 69
  Reserved12:
    <<: *reserved
    address: 70
  Reserved13:
    <<: *reserved
    address: 71
  Reserved14:
    <<: *reserved
    address: 72
  Reserved15:
    <<: *reserved
    address: 73
  Reserved16:
    <<: *reserved
    address: 74
  Reserved17:
    <<: *reserved
    address: 75
  Reserved18:
    <<: *reserved
    address: 76
  Reserved19:
    <<: *reserved
    address: 77
  Reserved20:
    <<: *reserved
    address: 78
  Reserved21:
    <<: *reserved
    address: 79
  Reserved22:
    <<: *reserved
    address: 80
  Reserved23:
    <<: *reserved
    address: 81
  Commands:
    address: 82
    type: U8
    access: Write
    maskType: ControllerCommand
    description: Send commands to PIC32 micro-controller
bitMasks:
  DigitalInputs:
    description: Specifies the state of the digital input lines.
    bits:
      DI0: {value: 1, description: Digital input 0.}
      DI1: {value: 2, description: Digital input 1.}
      DI2: {value: 4, description: Digital input 2 (don't have associated event).}
  DigitalOutputs:
    description: Specifies the state of the digital output lines.
    bits:
      DO0: {value: 1, description: Digital output 0.}
      DO1: {value: 2, description: Digital output 1.}
      DO2: {value: 4, description: Digital output 2.}
groupMasks:
  DigitalInputConfiguration:
    description: Specifies the operation mode of the digital input.
    values:
      Digital: {value: 0, description: Used as a pure digital input.}
      StartAndStopSound: {value: 1, description: Starts sound index (if less than 32) or frequency (if greater or equal than 32) when rising edge and stop when falling edge (frequency only).}
      StartSound: {value: 2, description: Starts sound index (if less than 32) or frequency (if greater or equal than 32) when rising edge.}
      StopSound: {value: 3, description: Stops frequency when rising edge.}
  DigitalOutputConfiguration:
    description: Specifies the operation mode of the digital output.
    values:
      Digital: {value: 0, description: Used as a pure digital output.}
      PulseForSoundStartOrFrequencyChange: {value: 1, description: Positive 500us pulse of when sound starts or frequency changes. }
  DataStreamConfiguration:
    description: Specifies the operation mode of the data stream.
    values:
      Disabled: 0
      StreamAt1Khz: 1
  Adc0Configuration:
    description: Specifies the operation mode of the analog input ADC0.
    values:
      AnalogInputOnly: 0
      ControlsLeftChannelAmplitude: 1
      ControlsBothChannelsAmplitude: 2
  Adc1Configuration:
    description: Specifies the operation mode of the analog input ADC1.
    values:
      AnalogInputOnly: 0
      ControlsRightChannelAmplitude: 1
      ControlsBothChannelsAmplitude: 2
      ControlsFrequencyGenerator: 3
  ControllerCommand:
    description: Specifies commands to send to the PIC32 micro-controller
    values:
      DisableBootloader: 0
      EnableBootloader: 1
      DeleteAllSounds: 255
